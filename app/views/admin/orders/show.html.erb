<div class="container p-3">
  <div class="row">
    <div class="col-md-12">
      <h4>注文履歴詳細</h4>

      <table class="table">
        <tr>
          <td>購入者</td>
          <td><%= @order.name %></td>
        </tr>
        <tr>
          <td>注文日</td>
          <td><%= @order.created_at.strftime('%Y/%m/%d') %></td>
        </tr>
        <tr>
          <td>配送先</td>
          <td>
            <%= @order.postal_code %><br>
            <%= @order.address %><br>
            <%= @order.name %>
          </td>
        </tr>
        <tr>
          <td>支払方法</td>
          <td><%= @order.payment_method_i18n %></td>
        </tr>
        <tr>
          <td>注文ステータス</td>
          <td>
            <%= form_with model: @order, url: admin_order_path(@order), method: :patch, local: true do |f| %>
              <!--ステータスの値（整数値）が表示される-->
              <%#= f.select :status, Order.statuses_i18n.keys.map %>

              <!--ステータスのキー（enumで定義された値）が表示される-->
              <!--.keys.map は、Rubyのハッシュからキーを取り出して配列に変換する処理-->
              <%= f.select :status, Order.statuses_i18n.invert %>
              <%= f.submit "更新", class: "btn btn-success" %>
            <% end %>
          </td>
        </tr>
      </table>

      <table class="table">
        <tr>
          <td>商品名</td>
          <td>単価(税込)</td>
          <td>数量</td>
          <td>小計</td>
          <td>製作ステータス</td>
        </tr>
        <% @order_details.each do |order_detail| %>
          <tr>
            <td><%= order_detail.item.name %></td>
            <td><%= order_detail.price %></td>
            <td><%= order_detail.amount %></td>
            <td><%= order_detail.price * order_detail.amount %></td>
            <td>
              <%= form_with model: order_detail, url: admin_order_order_detail_path(order_detail), method: :patch, local: true do |f| %>
                <%= f.select :making_status, OrderDetail.making_statuses_i18n.invert %>
                <%= f.submit "更新", class: "btn btn-success" %>
              <% end %>
            </td>
          </tr>
        <% end %>
        <tr>
          <td>商品合計</td>
          <td><%= @order_product_total %>円</td>
        </tr>
        <tr>
          <td>送料</td>
          <td>800円</td>
        </tr>
        <tr>
          <td>請求金額合計</td>
          <td><%= @order_product_total + 800 %>円</td>
        </tr>
      </table>

    </div>
  </div>
</div>